<div class="form-group flex-row right">
  <button class="evo-button small" (click)="addTruck()">Додати евакуатор</button>
</div>
<div *ngIf="!trucks.length">У вас ще немає жодного евакуатора</div>
<p-table [columns]="cols" [(value)]="trucks" [responsive]="true" *ngIf="trucks.length">
  <ng-template pTemplate="header">
    <tr>
      <th>Фото</th>
      <th>Номерний знак</th>
      <th>Марка</th>
      <th>Модель</th>
      <th>Підйомність</th>
      <th>Типи</th>
      <th>Геолокація</th>
      <th *ngIf="loggedUser.role =='company'">Водій</th>
      <th></th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-truck>
    <tr>
      <td>{{truck.photo}}</td>
      <td>{{truck.registration_number}}</td>
      <td>{{truck.car_attributes.brand.name}}</td>
      <td>{{truck.car_attributes.model.name}}</td>
      <td>{{truck.weight_limit}}</td>
      <td>
        <span *ngFor="let type of truck.car_types">{{type.name}}, </span>
      </td>
      <td>{{truck.address.label}}</td>
      <td *ngIf="loggedUser.role =='company'">{{truck.user ? truck.user.name : 'Без водія'}}</td>
      <td>
        <div class="flex-row center-around">
          <button pButton icon="fa-edit" (click)="editTruck(this.truck)"></button>
          <button class="ui-button-danger" pButton icon="fa-times" (click)="deleteTruck(this.truck)"></button>
        </div>
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="summary">
    Показано {{trucks?.length}} евакуаторів
  </ng-template>
</p-table>
<ng-template *ngIf="trucks.length">
  Ви додали ще жодного евакуатора :С
</ng-template>
<!-- <p-dataTable [(value)]="trucks">
  <p-column field="photo" header="Фото"></p-column>
  <p-column field="registration_number" header="Номерний знак"></p-column>
  <p-column field="car_attributes.brand.name" header="Марка"></p-column>
  <p-column field="car_attributes.model.name" header="Модель"></p-column>
  <p-column field="weight_limit" header="Вантажопідйомність"></p-column>
  <p-column field="(...car_types).name" header="Типи"></p-column>
  <p-column field="address.label" header="Місцезнаходження"></p-column>
</p-dataTable> -->

<p-dialog class="add-truck" header="Додавання евакуатора" [(visible)]="truckDialog" [width]="500" [baseZIndex]="9999" (onHide)="clearForm()">
  <form [formGroup]="truckForm" (ngSubmit)="submitCreation(truckForm.editMode ? 'editMode': 'addMode')">
    <div class="flex-row center-between">
      <div class="form-group">
        <span class="ui-float-label blue">
          <input pInputText id="name" formControlName="registration_number" class="form-control evo-input" type="text">
          <label for="registration_number">Реєстраційний номер</label>
        </span>
        <validation-messages [control]="truckForm.controls.registration_number"></validation-messages>
      </div>
      <div class="form-group">
        <span class="ui-float-label blue">
          <input pInputText NumberOnly id="name" formControlName="passengers_count" class="form-control evo-input" type="text">
          <label for="passengers_count">Кількість пасажирських місць</label>
        </span>
        <validation-messages [control]="truckForm.controls.passengers_count"></validation-messages>
      </div>
    </div>

    <div class="flex-row center-between">
      <div class="form-group">
        <span class="ui-float-label blue">
          <input pInputText NumberOnly id="name" formControlName="weight_limit" class="form-control evo-input" type="text">
          <label for="weight_limit">Вантажопідйомність(кг)</label>
        </span>
        <validation-messages [control]="truckForm.controls.weight_limit"></validation-messages>
      </div>
      <div class="form-group">
        <span class="ui-float-label blue">
          <input pInputText id="price" formControlName="price" class="form-control evo-input" type="text">
          <label for="price">Ціна за кілометр</label>
        </span>
        <validation-messages [control]="truckForm.controls.price"></validation-messages>
      </div>
    </div>
    <div formGroupName="car_attributes">
      <div class="form-group">
        <p-dropdown class="dropdown__blue" [options]="brands" [filter]="true" filterBy="label" formControlName="brand" (onChange)="carChanged($event)"
          optionLabel="name"></p-dropdown>
        <validation-messages [control]="truckForm.controls.car_attributes.controls.brand"></validation-messages>

      </div>
      <div class="form-group">
        <p-dropdown class="dropdown__blue" [options]="models" [filter]="true" filterBy="label" formControlName="model" optionLabel="name"></p-dropdown>
        <validation-messages [control]="truckForm.controls.car_attributes.controls.model"></validation-messages>
      </div>
    </div>



    <div *ngIf="loggedUser.role == 'company' " class="form-group">
      <p-dropdown class="dropdown__blue" [(options)]="drivers" formControlName="company_user_id" optionLabel="name"></p-dropdown>
      <validation-messages [control]="truckForm.controls.company_user_id"></validation-messages>

    </div>


    <div class="form-group">
      <p-multiSelect class="dropdown__blue" [options]="transportCategories" [maxSelectedLabels]="5" [defaultLabel]="'Типи транспорту для перевезення'"
        [displaySelectedLabel]="true" formControlName="car_types" optionLabel="name"></p-multiSelect>
      <validation-messages [control]="truckForm.controls.car_types"></validation-messages>

    </div>
    <div class="form-group" formGroupName="address">
      <span class="ui-float-label blue">
        <input type="text" formControlName="label" class="form-control evo-input" [options]='citiesOptions' (FormatAddress)="getFormattedAddress($event, 'address')"
          (street_number)='street_number=$event' (street)='street=$event' (city)='city=$event' (state)='state=$event' (district)='district=$event'
          (country)='country=$event' (postal_code)='postal_code=$event' (lat)='lat=$event' (lng)='lng=$event' (adr_address)='adr_address=$event'
          (name)='name=$event' (place_id)='place_id=$event' (types)='types=$event' (url)='url=$event' (utc_offset)='utc_offset=$event'
          (vicinity)='vicinity=$event' (photos)='photos=$event' (CountryCodes)='CountryCodes=$event' placeholder=" " id="address"
          angularGooglePlace pInputText/>
        <label for="address">Місцезнаходження</label>
        <validation-messages [control]="truckForm.controls.address.controls.label"></validation-messages>
      </span>
    </div>

    <div class="form-group">
      <span class="ui-float-label blue textarea">
        <textarea [rows]="3" pInputTextarea id="description" formControlName="description" class="form-control evo-input" placeholder="Примітка для клієнтів"></textarea>
      </span>
      <validation-messages [control]="truckForm.controls.description"></validation-messages>
    </div>

    <div class="form-group flex-row right">
      <button *ngIf="!truckForm.editMode" class="evo-button" type="submit">Додати</button>
      <button *ngIf="truckForm.editMode && truckForm.valid" class="evo-button" type="submit">Зберегти</button>

      <div (click)="setTest()">TEST</div>
    </div>
  </form>
  <div class="clearfix"></div>
</p-dialog>
