<div class="container">
  <div class="evo-trucks" *ngIf="trucks.length">
    <div class="evo-trucks__header row">
      <div class="col-md-2 evo-trucks__header__item">Фото</div>
      <div class="col-md-2 evo-trucks__header__item">Номерний знак</div>
      <div class="col-md-2 evo-trucks__header__item">Марка/модель</div>
      <div class="col-md-2 evo-trucks__header__item">Вантажопідйомність</div>
      <div class="col-md-2 evo-trucks__header__item">Тип</div>
      <div class="col-md-2 evo-trucks__header__item">Місцезнаходження</div>
    </div>
    <div class="evo-trucks__list">
      <ng-container *ngFor="let truck of trucks">
        <div class="evo-trucks__list__item row">
          <div class="col-md-2 evo-trucks__list__item__info evo-trucks__list__item__info-image" [ngStyle]="{'background-image': 'url(' + truck.photo + ')'}">
          </div>
          <div class="col-md-2 evo-trucks__list__item__info ">{{truck.registration_number}}</div>
          <div class="col-md-2 evo-trucks__list__item__info ">{{truck.car_attributes.brand.name}} {{truck.car_attributes.brand.model}}</div>
          <div class="col-md-2 evo-trucks__list__item__info ">{{truck.weight_limit}} кг</div>
          <div class="col-md-2 evo-trucks__list__item__info evo-trucks__list__item__info-transport">
            <div *ngFor="let item of truck.car_types" class="evo-trucks__list__item__info-transport__item type{{item.value}}"></div>
          </div>
          <div class="col-md-2 evo-trucks__list__item__info evo-trucks__list__item__info-adress ">{{truck.address.label}}</div>
        </div>
        <div class="flex-row right evo-trucks__list__actions">
          <div (click)="editTruck(this.truck)" class="evo-trucks__list__actions__item evo-trucks__list__actions__item-edit">Редагувати</div>
          <div (click)="deleteTruck(this.truck)" class="evo-trucks__list__actions__item evo-trucks__list__actions__item-delete">Видалити</div>
        </div>
      </ng-container>
    </div>
  </div>

  <div class="title__empty" *ngIf="!trucks.length">
    Ви не додали ще жодного евакуатора :С
  </div>

  <div class="flex-row right">
    <button class="evo-button evo-button-purple" (click)="addTruck()">Додати авто</button>
  </div>

  <!-- ___________________________________________DIALOG_______________________________________________ -->
  <p-dialog class="evo-dialog" [responsive]="true" [modal]="true" [width]="840" header="Додавання евакуатора" [(visible)]="truckDialog"
    (onHide)="clearForm()">
    <form [formGroup]="truckForm" class="evo-form" (ngSubmit)="submitCreation(truckForm.editMode ? 'editMode': 'addMode')">
      <div class="row">
        <div class="form-group col-md-6 col-sm-6 col-xs-12">
          <div class="evo-input" [ngClass]="{'error': truckForm.controls.registration_number.invalid && truckForm.controls.registration_number.touched,
            'check': truckForm.controls.registration_number.valid && truckForm.controls.registration_number.touched }">
            <input pInputText id="name" placeholder="Введіть реєстраційний номер" formControlName="registration_number" class="form-control "
              type="text">
            <label for="registration_number">Реєстраційний номер
              <span>*</span>
            </label>
          </div>
        </div>
        <ng-container formGroupName="car_attributes">
          <div class="form-group col-md-6 col-sm-6 col-xs-12">
            <div class="evo-dropdown">
              <p-dropdown [options]="brands" [filter]="true" filterBy="label" formControlName="brand" (onChange)="carChanged($event)" optionLabel="name"></p-dropdown>
              <label>Марка авто
                <span>*</span>
              </label>
              <div class="evo-dropdown__trigger">
                <i class="fa fa-chevron-down"></i>
              </div>
            </div>

          </div>
          <div class="form-group col-md-6 col-sm-6 col-xs-12">
            <div class="evo-dropdown">
              <p-dropdown [options]="models" [filter]="true" filterBy="label" formControlName="model" optionLabel="name"></p-dropdown>
              <label>Модель авто
                <span>*</span>
              </label>
              <div class="evo-dropdown__trigger">
                <i class="fa fa-chevron-down"></i>
              </div>
            </div>
          </div>
        </ng-container>
        <div class="form-group col-md-6 col-sm-6 col-xs-12">
          <div class="evo-dropdown">
            <p-multiSelect [options]="transportCategories" [maxSelectedLabels]="3" [defaultLabel]="'Типи транспорту для перевезення'"
              [displaySelectedLabel]="true" formControlName="car_types" optionLabel="name"></p-multiSelect>
            <label>Тип транспортного засобу для евакуації
              <span>*</span>
            </label>
            <div class="evo-dropdown__trigger">
              <i class="fa fa-chevron-down"></i>
            </div>
          </div>

        </div>
        <div class="form-group col-md-6 col-sm-6 col-xs-12">
          <div class="evo-input" [ngClass]="{'error': truckForm.controls.weight_limit.invalid && truckForm.controls.weight_limit.touched,
            'check': truckForm.controls.weight_limit.valid && truckForm.controls.weight_limit.touched }">
            <input pInputText NumberOnly id="name" placeholder="Вкажіть вантажопідйомність" formControlName="weight_limit" class="form-control "
              type="text">
            <label for="weight_limit">Вантажопідйомність(кг)
              <span>*</span>
            </label>
          </div>
        </div>
        <div class="form-group col-md-3 col-sm-3 col-xs-12">
          <div class="evo-input" [ngClass]="{'error': truckForm.controls.passengers_count.invalid && truckForm.controls.passengers_count.touched,
            'check': truckForm.controls.passengers_count.valid && truckForm.controls.passengers_count.touched }">
            <input pInputText NumberOnly placeholder="Не вказано" id="name" formControlName="passengers_count" class="form-control "
              type="text">
            <label for="passengers_count">Пасажирів
              <span>*</span>
            </label>
          </div>
        </div>

        <div class="form-group col-md-3 col-sm-3 col-xs-12">
          <div class="evo-input" [ngClass]="{'error': truckForm.controls.price.invalid && truckForm.controls.price.touched,
            'check': truckForm.controls.price.valid && truckForm.controls.price.touched }">
            <input pInputText id="price" placeholder="Не вказано" formControlName="price" class="form-control " type="text">
            <label for="price">Ціна за км</label>
          </div>
        </div>

        <div *ngIf="loggedUser.role == 'company' " class="form-group col-md-6 col-sm-6 col-xs-12">
          <div class="evo-dropdown">
            <p-dropdown [(options)]="drivers" formControlName="company_user_id" optionLabel="name"></p-dropdown>
          </div>

        </div>

        <div class="form-group col-md-12 col-sm-12 col-xs-12" formGroupName="address">
          <google-places *ngIf="truckDialog" [type]="'address'" [placeholder]="'Вкажіть місцезнаходження авто'" [label]="{en:'address', ua:'Місцезнаходження'}"
            [defaultAddress]="this.truckForm.controls.address.controls" (locationData)="getAddress($event, 'address')"></google-places>
        </div>

        <div class="form-group col-md-6 col-sm-6 col-xs-12">
          <p-fileUpload name="myfile[]" [chooseLabel]="'Додати фото'" mode="basic" (uploadHandler)="myUploader($event)"></p-fileUpload>
        </div>

        <div class="form-group col-md-6 col-sm-6 col-xs-12">
          <div class="evo-input textarea" [ngClass]="{'error': truckForm.controls.description.invalid && truckForm.controls.description.touched,
            'check': truckForm.controls.description.valid && truckForm.controls.description.touched }">
            <textarea [rows]="3" pInputTextarea id="description" formControlName="description" class="form-control " placeholder="Ваш текст"></textarea>
            <label>Примітка для клієнтів</label>
          </div>
        </div>
        <div class="clearfix"></div>
        <div class="flex-row col-md-6 col-md-offset-3 col-sm-6 col-sm-offset-3 col-xs-12 ">
          <button (click)="truckDialog = !truckDialog" class="evo-button evo-button-solid-green">Скасувати</button>
          <button class="evo-button evo-button-green" type="submit">Зберегти</button>
        </div>
      </div>
    </form>
    <div class="clearfix"></div>
  </p-dialog>
  <div class="clearfix"></div>
</div>
